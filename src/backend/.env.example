# Enable production mode
PRODUCTION=true
CORS_ORIGINS=http://localhost:3000,https://pyreflect.shlawg.com

#MongoDB Storage
MONGODB_URI=

# Hugging Face Settings
# Create token with WRITE permission at https://huggingface.co/settings/tokens
HF_TOKEN=
HF_REPO_ID=

# Model storage strategy (worker-side)
# - hf: upload model directly to Hugging Face (no local .pth saved)
# - local: save to src/backend/data/models
MODEL_STORAGE=hf

# Limits (Production)
MAX_CURVES=5000
MAX_FILM_LAYERS=10
MAX_EPOCHS=50
MAX_BATCH_SIZE=64
MAX_CNN_LAYERS=12
MAX_DROPOUT=0.5
MAX_LATENT_DIM=32
MAX_AE_EPOCHS=100
MAX_MLP_EPOCHS=100

# Optional: allowlisted users for local/unlimited limits.
# When PRODUCTION=true and `X-User-ID` is in this list, the backend will use the
# local/unlimited limit table.
LIMITS_WHITELIST_USER_IDS=


# Redis Queue (RQ) for background jobs
# Local dev: install Redis locally (macOS: brew install redis && redis-server)
# Modal GPU workers: REDIS_URL must be reachable from Modal (NOT localhost).
REDIS_URL=redis://localhost:6379
RQ_JOB_TIMEOUT=2h

# Remote worker behavior
# If true, the backend will attempt to trigger a Modal GPU worker immediately after enqueuing a job.
# (No schedules required; this is on-demand.)
MODAL_INSTANT_SPAWN=true
MODAL_APP_NAME=pyreflect-worker
MODAL_FUNCTION_NAME=poll_queue
MODAL_SPAWN_LOCK_TTL_S=900
# Optional: HTTP fallback (points to the Modal `poll_queue_http` web endpoint URL)
MODAL_POLL_URL=https://<your-modal-endpoint>/poll_queue_http
# Optional auth token for the HTTP endpoint (also set in the Modal secret as MODAL_TRIGGER_TOKEN).
# Sent as `?token=...` query parameter.
MODAL_TRIGGER_TOKEN=

# Training job meta update throttling (reduces Redis round-trips on fast GPUs)
RQ_META_FLUSH_INTERVAL_S=1.0
RQ_MAX_LOG_LINES=250

# If true, fail the job if Mongo is configured but unreachable.
REQUIRE_MONGO_SAVE=false

# Start a local RQ worker subprocess inside the API process.
# Set to false if you're using remote workers (e.g. Modal).
START_LOCAL_RQ_WORKER=false

# Basic abuse controls (best-effort, per-process)
RATE_LIMIT_JOBS_SUBMIT_PER_MIN=30
RATE_LIMIT_UPLOAD_PER_MIN=10

# Debug endpoint protection
# If set, POST /api/queue/spawn requires header: X-Admin-Token
ADMIN_TOKEN=
